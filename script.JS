const categorias = [
    {
        id: 1,
        nombre: "Razones por las que te amo",
        icono: "‚ù§Ô∏è",
        color: "#FF69B4",
        testamentos: [
            "Te amo por tu dulzura infinita",
            "Te amo por tu forma de hacerme sonre√≠r",
            "Te amo por c√≥mo iluminas mis d√≠as"
        ]
    },
    {
        id: 2,
        nombre: "Momentos especiales",
        icono: "‚ú®",
        color: "#9370DB",
        testamentos: [
            "Nuestro primer beso fue m√°gico",
            "Cada abrazo tuyo es especial",
            "Me encanta cuando me sorprendes"
        ]
    },
    {
        id: 3,
        nombre: "Sue√±os juntos",
        icono: "üåü",
        color: "#20B2AA",
        testamentos: [
            "Sue√±o con envejecer a tu lado",
            "Quiero viajar por el mundo contigo",
            "Imagino nuestro futuro juntos"
        ]
    },
    {
        id: 4,
        nombre: "Detalles que amo de ti",
        icono: "üíù",
        color: "#FF1493",
        testamentos: [
            "Amo c√≥mo arruga tu nariz cuando sonr√≠es",
            "Amo tus ojitos cuando est√°s feliz",
            "Amo cada detalle que te hace √∫nica"
        ]
    },
    {
        id: 5,
        nombre: "Promesas de amor",
        icono: "ü§ç",
        color: "#4169E1",
        testamentos: [
            "Prometo amarte cada d√≠a m√°s",
            "Prometo ser tu apoyo incondicional",
            "Prometo hacerte feliz siempre"
        ]
    },
    {
        id: 6,
        nombre: "Cambios de Aurora",
        icono: "üë©üèΩ",
        color: "#4B0082",
        testamentos: [
            "Recuerdo nuestra primera cita",
            "Recuerdo nuestras risas juntos",
            "Recuerdo cada momento especial"
        ]
    },
    {
        id: 7,
        nombre: "Pensamientos de amor",
        icono: "üí≠",
        color: "#FFB6C1",
        testamentos: [
            "Pienso en ti cada momento del d√≠a",
            "Eres el primer pensamiento al despertar",
            "Mis pensamientos siempre te pertenecen"
        ]
    },
    {
        id: 8,
        nombre: "Secretos de Amor",
        icono: "üîê",
        color: "#FF1493",
        testamentos: [
            "Guardo cada nota que me escribes",
            "Sonr√≠o cada vez que pienso en ti",
            "Me encanta verte dormir"
        ]
    },
    {
        id: 9,
        nombre: "Nuestras Aventuras",
        icono: "üåü",
        color: "#4B0082",
        testamentos: [
            "Nuestro primer viaje juntos",
            "Esa vez que nos perdimos",
            "Nuestra aventura bajo la lluvia"
        ]
    },
    {
        id: 10,
        nombre: "Momentos Graciosos",
        icono: "üòä",
        color: "#FF69B4",
        testamentos: [
            "Cuando te ca√≠ste y no pod√≠as parar de re√≠r",
            "Tus chistes malos que me hacen re√≠r",
            "Nuestras fotos haciendo caras chistosas"
        ]
    },
    {
        id: 11,
        nombre: "Deseos Futuros",
        icono: "‚ú®",
        color: "#9400D3",
        testamentos: [
            "Quiero despertar cada d√≠a a tu lado",
            "Sue√±o con crear miles de recuerdos juntos",
            "Imagino una vida llena de aventuras contigo"
        ]
    },
    {
        id: 12,
        nombre: "Mis Favoritos",
        icono: "‚≠ê",
        color: "#FFD700",
        testamentos: []
    }
];

// Al inicio del archivo, agregar las variables globales necesarias
let paginaActual = 1;
const categoriasPorPagina = 4;
let indiceTestamento = 0;
let testamentos = [];
let categoriaIndex = 0;
let favoritos = [];
let reacciones = JSON.parse(localStorage.getItem('reaccionesTestamentos')) || {};

// Variables para controlar la direcci√≥n
let paginaAnterior = 1;

// Agregar al inicio del archivo, despu√©s de las variables
const coloresError = ['#ff69b4', '#ff1493', '#ff0000', '#9370DB', '#4169E1', '#20B2AA'];
let intentos = 0;

let isDarkMode = localStorage.getItem('darkMode') === 'true';

// Funci√≥n para toggle del tema
function toggleTheme() {
    isDarkMode = !isDarkMode;
    document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
    localStorage.setItem('darkMode', isDarkMode);
    
    // Cambiar el icono del bot√≥n
    const themeIcon = document.querySelector('.theme-icon');
    themeIcon.textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
}

function mostrarErrorNombre() {
    const mensajeError = document.getElementById('error-nombre');
    const tamanoBase = 16; // Tama√±o base en pxeles
    
    // Aumentar el tama√±o con cada intento (m√°ximo 24px)
    const nuevoTamano = Math.min(tamanoBase + (intentos * 2), 24);
    
    // Cambiar color y tama√±o
    mensajeError.style.fontSize = `${nuevoTamano}px`;
    mensajeError.style.color = coloresError[intentos % coloresError.length];
    mensajeError.style.display = 'block';
    
    // Agregar animaci√≥n de shake
    mensajeError.style.animation = 'shake 0.5s ease-in-out';
    
    intentos++;
    
    // Quitar la animaci√≥n despu√©s de que termine
    setTimeout(() => {
        mensajeError.style.animation = '';
    }, 500);
}

// Asegurarnos de que el loader se inicie cuando se carga la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    // Iniciar el loader primero
    startLoader();
    
    // Cargar favoritos guardados
    const favoritosGuardados = localStorage.getItem('testamentosFavoritos');
    if (favoritosGuardados) {
        favoritos = JSON.parse(favoritosGuardados);
        const categoriaFavoritos = categorias.find(c => c.nombre === "Mis Favoritos");
        if (categoriaFavoritos) {
            const favoritosActualizados = favoritos.map(f => {
                const categoriaOriginal = categorias.find(c => c.nombre === f.categoria);
                if (categoriaOriginal && categoriaOriginal.testamentos[f.index]) {
                    return {
                        texto: categoriaOriginal.testamentos[f.index],
                        info: `${categoriaOriginal.nombre} - ${f.index + 1}`
                    };
                }
                return null;
            }).filter(f => f !== null);
            
            categoriaFavoritos.testamentos = favoritosActualizados.map(f => f.texto);
            categoriaFavoritos.infoCategorias = favoritosActualizados.map(f => f.info);
        }
    }
    
    // Configurar tema inicial
    if (isDarkMode) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.querySelector('.theme-icon').textContent = '‚òÄÔ∏è';
    }
    
    // Agregar evento al bot√≥n
    document.getElementById('toggleTheme').addEventListener('click', toggleTheme);
    
    // Configurar el evento del bot√≥n comenzar
    document.getElementById('btn-comenzar').addEventListener('click', function() {
        const nombreInput = document.getElementById('nombre');
        const nombreIngresado = nombreInput.value.toLowerCase().trim();
        const nombresPermitidos = ["auro", "aurora", "aurori"];
        
        // Ocultar todos los mensajes de error primero
        document.getElementById('error-mensaje').style.display = 'none';
        document.getElementById('error-nombre').style.display = 'none';
        document.getElementById('mensaje-easter-egg').style.display = 'none';

        // Validar el nombre
        if (!nombreIngresado) {
            document.getElementById('error-mensaje').style.display = 'block';
            return;
        }

        // Verificar si es un nombre permitido
        if (nombresPermitidos.includes(nombreIngresado)) {
            document.getElementById('nombre-usuario').textContent = 
                nombreIngresado.charAt(0).toUpperCase() + nombreIngresado.slice(1);
            mostrarMenu('menu-categorias');
            mostrarCategorias();
        } else if (nombreIngresado === 'dulce') {
            document.getElementById('mensaje-easter-egg').style.display = 'block';
        } else {
            document.getElementById('error-nombre').style.display = 'block';
        }
    });

    // Tambi√©n permitir enviar con Enter
    document.getElementById('nombre').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('btn-comenzar').click();
        }
    });

    createFloatingHearts();

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    console.log('SW registrado correctamente:', registration);
                })
                .catch(error => {
                    console.log('Error al registrar SW:', error);
                });
        });
    }
});

// Funci√≥n del loader ajustada para mostrar textos cada 31%
function startLoader() {
    const progreso = document.getElementById('progreso');
    const porcentajeTexto = document.getElementById('porcentaje');
    const textos = [
        document.getElementById('texto1'),
        document.getElementById('texto2'),
        document.getElementById('texto3'),
        document.getElementById('texto4')
    ];
    let porcentaje = 0;
    let textoActual = 0;

    function mostrarTextoAleatorio() {
        textos.forEach(texto => texto.style.opacity = "0");
        textos[textoActual].style.opacity = "1";
        textoActual = (textoActual + 1) % textos.length;
    }

    const intervalo = setInterval(() => {
        if (porcentaje >= 100) {
            clearInterval(intervalo);
            setTimeout(() => {  // Agregar delay extra al final
                document.getElementById('loader-container').style.display = 'none';
                document.getElementById('menu-nombres').style.display = 'block';
            }, 1000);
        } else {
            porcentaje += 0.5;
            progreso.style.width = porcentaje + '%';
            porcentajeTexto.textContent = Math.round(porcentaje) + '%';
            
            if (porcentaje % 31 === 0) {
                mostrarTextoAleatorio();
            }
        }
    }, 50);  // Mantener la velocidad pero agregar delay al final

    mostrarTextoAleatorio();
}

function mostrarTestamentoPorCategoria(index) {
    categoriaIndex = index;
    const categoria = categorias[index];
    testamentos = categoria.testamentos;
    indiceTestamento = 0;
    
    // Actualizar t√≠tulo de la categor√≠a
    document.getElementById('categoria-titulo').textContent = categoria.nombre;
    
    // Actualizar color de fondo del testamento seg√∫n la categor√≠a
    const testamentoContainer = document.getElementById('testamento-container');
    testamentoContainer.style.backgroundColor = categoria.color;
    
    // Mostrar el men√∫ de testamentos
    mostrarMenu('menu-testamentos');
    
    // Mostrar el primer testamento con carga
    mostrarTestamento();
}

// Funci√≥n para mostrar categor√≠as
function mostrarCategorias() {
    const contenedorCategorias = document.getElementById('categoria-container');
    const direccion = paginaActual > paginaAnterior ? 'left' : 'right';
    
    // Efecto de salida
    contenedorCategorias.style.opacity = '0';
    
    setTimeout(() => {
        const inicio = (paginaActual - 1) * categoriasPorPagina;
        const fin = inicio + categoriasPorPagina;
        
        // Limpiar el contenedor
        contenedorCategorias.innerHTML = '';
        
        // Mostrar las categor√≠as
        for (let i = inicio; i < fin && i < categorias.length; i++) {
            const categoria = categorias[i];
            const categoriaDiv = document.createElement('div');
            categoriaDiv.className = 'categoria-item fade-in';
            categoriaDiv.style.backgroundColor = categoria.color;
            categoriaDiv.innerHTML = `
                <div class="categoria-icono">${categoria.icono}</div>
                <div class="categoria-nombre">${categoria.nombre}</div>
            `;
            categoriaDiv.onclick = () => mostrarTestamentoPorCategoria(i);
            contenedorCategorias.appendChild(categoriaDiv);
        }

        // Aplicar animaci√≥n seg√∫n direcci√≥n
        contenedorCategorias.style.opacity = '1';
        contenedorCategorias.className = `slide-${direccion}`;
        
        // Actualizar el n√∫mero de p√°gina
        actualizarNumeroPagina();
        
    }, 300);
}

// Funci√≥n para actualizar el n√∫mero de p√°gina
function actualizarNumeroPagina() {
    const totalPaginas = Math.ceil(categorias.length / categoriasPorPagina);
    const numeroPagina = document.getElementById('numero-pagina');
    numeroPagina.textContent = `${paginaActual}/${totalPaginas}`;
}

// Funciones de navegaci√≥n de categor√≠as
function anteriorCategoria() {
    if (paginaActual > 1) {
        paginaAnterior = paginaActual;
        paginaActual--;
        mostrarCategorias();
    }
}

function siguienteCategoria() {
    const totalPaginas = Math.ceil(categorias.length / categoriasPorPagina);
    if (paginaActual < totalPaginas) {
        paginaAnterior = paginaActual;
        paginaActual++;
        mostrarCategorias();
    }
}

// Funci√≥n para mostrar/ocultar men√∫s
function mostrarMenu(menuId) {
    document.getElementById('menu-nombres').style.display = 'none';
    document.getElementById('menu-categorias').style.display = 'none';
    document.getElementById('menu-testamentos').style.display = 'none';
    document.getElementById(menuId).style.display = 'block';
}

// Modificar la funci√≥n mostrarTestamento para incluir los bordes
function mostrarTestamento() {
    const contenido = document.getElementById('contenido-testamento');
    const categoriaInfo = document.getElementById('categoria-info');
    const numeroPagina = document.getElementById('numero-pagina-testamento');
    const favoritoBtn = document.querySelector('.favorito-btn');
    
    // Ocultar elementos durante la carga
    categoriaInfo.style.display = 'none';
    numeroPagina.style.visibility = 'hidden';
    favoritoBtn.style.visibility = 'hidden';
    
    // Eliminar reacciones anteriores si existen
    const reaccionesAnteriores = document.querySelector('.reacciones-container');
    if (reaccionesAnteriores) {
        reaccionesAnteriores.remove();
    }
    
    // Mostrar "Cargando" con la clase para la animaci√≥n
    contenido.textContent = "Cargando";
    contenido.className = 'loading';
    
    setTimeout(() => {
        // Mostrar el testamento
        contenido.textContent = testamentos[indiceTestamento];
        contenido.className = '';
        
        // Actualizar y mostrar n√∫mero de p√°gina
        numeroPagina.textContent = `${indiceTestamento + 1}/${testamentos.length}`;
        numeroPagina.style.visibility = 'visible';
        
        // Mostrar bot√≥n de favoritos
        favoritoBtn.style.visibility = 'visible';
        
        // Verificar si es favorito
        const categoriaActual = categorias[categoriaIndex].nombre;
        const esFavorito = favoritos.some(f => 
            f.categoria === categoriaActual && 
            f.index === indiceTestamento
        );
        favoritoBtn.classList.toggle('activo', esFavorito);
        
        // Mostrar info de categor√≠a si estamos en favoritos
        if (categoriaActual === "Mis Favoritos") {
            categoriaInfo.textContent = categorias[categoriaIndex].infoCategorias[indiceTestamento];
            categoriaInfo.style.display = 'block';
        } else {
            // Solo agregar reacciones si NO estamos en favoritos
            agregarReacciones();
        }
    }, 2000);
}

// Agregar funciones de navegaci√≥n de testamentos
function anteriorTestamento() {
    if (indiceTestamento > 0) {
        indiceTestamento--;
        mostrarTestamento();
    }
}

function siguienteTestamento() {
    if (indiceTestamento < testamentos.length - 1) {
        indiceTestamento++;
        mostrarTestamento();
    }
}

// Funci√≥n para volver al men√∫ de categor√≠as
function volverMenu() {
    mostrarMenu('menu-categorias');
}

// Funci√≥n mejorada para toggle favorito
function toggleFavorito() {
    const favoritoBtn = document.querySelector('.favorito-btn');
    let esFavorito = false;

    if (categorias[categoriaIndex].nombre === "Mis Favoritos") {
        // Eliminar de favoritos
        favoritos.splice(indiceTestamento, 1);
        favoritoBtn.classList.remove('activo');
        
        // Actualizar los testamentos
        obtenerTestamentosFavoritos();
        
        if (favoritos.length === 0) {
            const contenido = document.getElementById('contenido-testamento');
            contenido.textContent = "A√∫n no tienes testamentos favoritos. ¬°Marca algunos con la ‚≠ê!";
            document.querySelector('.navegacion-testamentos').style.display = 'none';
            document.getElementById('categoria-info').style.display = 'none';
        } else {
            if (indiceTestamento >= favoritos.length) {
                indiceTestamento = favoritos.length - 1;
            }
            mostrarTestamento();
        }
    } else {
        const categoriaActual = categorias[categoriaIndex].nombre;
        esFavorito = favoritos.some(f => 
            f.categoria === categoriaActual && 
            f.index === indiceTestamento
        );
        
        if (esFavorito) {
            // Remover de favoritos
            const index = favoritos.findIndex(f => 
                f.categoria === categoriaActual && 
                f.index === indiceTestamento
            );
            favoritos.splice(index, 1);
            favoritoBtn.classList.remove('activo');
        } else {
            // Agregar a favoritos
            favoritos.push({
                categoria: categoriaActual,
                index: indiceTestamento
            });
            favoritoBtn.classList.add('activo');
        }
    }
    
    localStorage.setItem('testamentosFavoritos', JSON.stringify(favoritos));
    obtenerTestamentosFavoritos();
}

// Agregar funci√≥n para obtener los testamentos favoritos
function obtenerTestamentosFavoritos() {
    const favoritosGuardados = favoritos.map(f => {
        const categoria = categorias.find(c => c.nombre === f.categoria);
        if (categoria && categoria.nombre !== "Mis Favoritos") {
            return {
                texto: categoria.testamentos[f.index],
                info: `${categoria.nombre} - ${f.index + 1}`
            };
        }
        return null;
    }).filter(t => t !== null);
    
    const categoriaFavoritos = categorias.find(c => c.nombre === "Mis Favoritos");
    if (categoriaFavoritos) {
        categoriaFavoritos.testamentos = favoritosGuardados.map(f => f.texto);
        categoriaFavoritos.infoCategorias = favoritosGuardados.map(f => f.info);
    }
}

// Funci√≥n para agregar las reacciones al testamento
function agregarReacciones() {
    const reaccionesDiv = document.createElement('div');
    reaccionesDiv.className = 'reacciones-container';
    
    const testamentoId = `${categorias[categoriaIndex].nombre}-${indiceTestamento}`;
    const reaccionesGuardadas = reacciones[testamentoId] || {};
    
    const reaccionesEmojis = [
        { emoji: 'üíö', nombre: 'amor' },
        { emoji: 'üò≠', nombre: 'triste' },
        { emoji: 'ü§î', nombre: 'pensativo' },
        { emoji: 'ü•∫', nombre: 'tierno' }
    ];
    
    reaccionesEmojis.forEach(({emoji, nombre}) => {
        const btn = document.createElement('div');
        btn.className = 'reaccion-btn';
        btn.innerHTML = emoji;
        
        // Verificar si esta reacci√≥n espec√≠fica est√° activa
        if (reaccionesGuardadas[nombre]) {
            btn.classList.add('activo');
            // Agregar el contador si hay una reacci√≥n guardada
            let contador = document.createElement('span');
            contador.className = 'contador-reaccion';
            contador.textContent = '1';
            btn.appendChild(contador);
        }
        
        btn.onclick = () => {
            // Desactivar todas las dem√°s reacciones y sus contadores
            reaccionesDiv.querySelectorAll('.reaccion-btn').forEach(otherBtn => {
                if (otherBtn !== btn) {
                    otherBtn.classList.remove('activo');
                    const contador = otherBtn.querySelector('.contador-reaccion');
                    if (contador) {
                        contador.remove();
                    }
                }
            });
            
            toggleReaccion(nombre, testamentoId, btn);
        };
        
        reaccionesDiv.appendChild(btn);
    });
    
    document.getElementById('testamento-container').appendChild(reaccionesDiv);
}

// Funci√≥n para toggle de reacci√≥n
function toggleReaccion(nombre, testamentoId, btn) {
    if (!reacciones[testamentoId]) {
        reacciones[testamentoId] = {};
    }
    
    // Limpiar otras reacciones para este testamento
    Object.keys(reacciones[testamentoId]).forEach(key => {
        delete reacciones[testamentoId][key];
    });
    
    if (!reacciones[testamentoId][nombre]) {
        reacciones[testamentoId][nombre] = 1;
        btn.classList.add('activo');
        
        // Agregar el contador
        let contador = document.createElement('span');
        contador.className = 'contador-reaccion';
        contador.textContent = '1';
        btn.appendChild(contador);
    } else {
        delete reacciones[testamentoId][nombre];
        btn.classList.remove('activo');
        
        // Remover el contador si existe
        const contador = btn.querySelector('.contador-reaccion');
        if (contador) {
            contador.remove();
        }
    }
    
    localStorage.setItem('reaccionesTestamentos', JSON.stringify(reacciones));
}

// Agregar al inicio del archivo o donde est√°n los event listeners
document.addEventListener('keydown', function(e) {
    // Solo si estamos en el men√∫ de categor√≠as o testamentos
    const menuCategorias = document.getElementById('menu-categorias');
    const menuTestamentos = document.getElementById('menu-testamentos');
    
    if (menuCategorias.style.display === 'block') {
        // Navegaci√≥n en el men√∫ de categor√≠as
        switch(e.key) {
            case 'ArrowLeft':
                anteriorCategoria();
                break;
            case 'ArrowRight':
                siguienteCategoria();
                break;
            case 'Enter':
                // Seleccionar la categor√≠a actual
                const categorias = document.querySelectorAll('.categoria-item');
                const categoriaActual = categorias[(paginaActual - 1) * categoriasPorPagina];
                if (categoriaActual) {
                    categoriaActual.click();
                }
                break;
        }
    }
    
    if (menuTestamentos.style.display === 'block') {
        // Navegaci√≥n en los testamentos
        switch(e.key) {
            case 'ArrowLeft':
                anteriorTestamento();
                break;
            case 'ArrowRight':
                siguienteTestamento();
                break;
            case 'Escape':
                volverMenu();
                break;
            case ' ': // Tecla espaciadora
            case 'f':
            case 'F':
                toggleFavorito();
                break;
        }
    }
});

// Funci√≥n para crear corazones flotantes
function createFloatingHearts() {
    const container = document.createElement('div');
    container.className = 'floating-hearts';
    document.body.appendChild(container);

    // Aumentar corazones iniciales de 8 a 15
    for (let i = 0; i < 15; i++) {
        createHeart(container);
    }

    // Reducir el intervalo de 800ms a 600ms y aumentar l√≠mite m√°ximo
    setInterval(() => {
        // Verificar la cantidad actual de corazones
        const heartCount = container.children.length;
        // Aumentar el l√≠mite de 12 a 20 corazones en pantalla
        if (heartCount < 25) {
            createHeart(container);
        }
    }, 600);
}

function createHeart(container) {
    const heart = document.createElement('div');
    heart.className = 'heart';
    heart.innerHTML = 'üíó';
    heart.style.left = Math.random() * 100 + 'vw';
    // Mantener la duraci√≥n de animaci√≥n entre 4 y 8 segundos
    heart.style.animationDuration = (Math.random() * 4 + 4) + 's';
    container.appendChild(heart);
    
    heart.addEventListener('animationend', () => {
        heart.remove();
    });
}

// Verificar conexi√≥n
window.addEventListener('online', function() {
    console.log('Conexi√≥n restaurada');
    // Sincronizar datos
});

window.addEventListener('offline', function() {
    console.log('Sin conexi√≥n');
    // Mostrar mensaje al usuario
});

if ('Notification' in window) {
    Notification.requestPermission()
        .then(permission => {
            if (permission === 'granted') {
                // Configurar notificaciones
            }
        });
}

// Reemplazar el c√≥digo actual de notificaciones por este:
function solicitarPermisoNotificaciones() {
    // Solo intentar si las notificaciones est√°n disponibles
    if ('Notification' in window) {
        // Verificar si ya est√°n bloqueadas
        if (Notification.permission === 'denied') {
            console.log('Las notificaciones fueron bloqueadas por el usuario');
            return;
        }
        
        // Verificar si ya est√°n concedidas
        if (Notification.permission === 'granted') {
            console.log('Permisos de notificaci√≥n ya concedidos');
            return;
        }
        
        // Mostrar un bot√≥n o mensaje al usuario antes de solicitar el permiso
        const btnNotificaciones = document.createElement('button');
        btnNotificaciones.textContent = '¬øDeseas recibir notificaciones?';
        btnNotificaciones.className = 'notificaciones-btn';
        btnNotificaciones.onclick = () => {
            Notification.requestPermission()
                .then(permission => {
                    if (permission === 'granted') {
                        console.log('Permisos de notificaci√≥n concedidos');
                        btnNotificaciones.remove();
                    }
                });
        };
        
        // Agregar el bot√≥n en alg√∫n lugar apropiado de tu UI
        document.getElementById('menu-nombres').appendChild(btnNotificaciones);
    }
}

// Llamar a la funci√≥n cuando sea apropiado
document.addEventListener('DOMContentLoaded', () => {
    // ... resto de tu c√≥digo existente ...
    
    // Solicitar notificaciones solo despu√©s de que el usuario interact√∫e
    document.getElementById('btn-comenzar').addEventListener('click', () => {
        // ... tu c√≥digo existente ...
        solicitarPermisoNotificaciones();
    });
});

// Agregar al inicio del archivo
let currentOrientation = localStorage.getItem('orientation') || 'portrait';

function toggleOrientation() {
    try {
        const orientationBtn = document.getElementById('toggleOrientation');
        const orientationIcon = orientationBtn.querySelector('.orientation-icon');
        
        currentOrientation = currentOrientation === 'portrait' ? 'landscape' : 'portrait';
        
        // Guardar preferencia
        localStorage.setItem('orientation', currentOrientation);
        
        // Actualizar UI
        document.body.style.orientation = currentOrientation;
        orientationBtn.classList.toggle('landscape');
        
        // Actualizar manifest din√°micamente
        const manifestLink = document.querySelector('link[rel="manifest"]');
        const manifestData = {
            // ... resto del manifest ...
            orientation: currentOrientation
        };
        
        const blob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        manifestLink.href = manifestURL;
    } catch (error) {
        console.error('Error al cambiar orientaci√≥n:', error);
    }
}

// Agregar al DOMContentLoaded
document.addEventListener('DOMContentLoaded', () => {
    // ... c√≥digo existente ...
    
    // Configurar orientaci√≥n inicial
    const orientationBtn = document.getElementById('toggleOrientation');
    if (currentOrientation === 'landscape') {
        orientationBtn.classList.add('landscape');
    }
    
    orientationBtn.addEventListener('click', toggleOrientation);
});
